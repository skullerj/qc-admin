<link rel="import" href="../../bower_components/polymer-redux/polymer-redux.html">
<link rel="import" href="global-state.html">
<link rel="import" href="reducers/user-reducer.html">

<script type="text/javascript">
  const standardHeaders = new Headers({
    'Content-Type': 'application/json'
  });
  function handleReqError(response) {
    if (response.ok) {
      return Promise.resolve(response);
    }
    return response.json().then(json => {
      const error = new Error(json.error || response.statusText)
      return Promise.reject(Object.assign(error, { response }))
    })
  };
  function showMessage(message,duration){
     window.dispatchEvent(new CustomEvent('show-message',{'detail':{message : message, duration: duration}}),{bubbles:false});
  }
  function redirect(location){
    window.history.pushState({}, null, location);
    window.dispatchEvent(new CustomEvent('location-changed'));
  }
  function checkLogIn(){
    var found = false,name='authenticated',value='1';
    document.cookie.split(";").forEach(function(e) {
        var cookie = e.split("=");
        if(name == cookie[0].trim() && (!value || value == cookie[1].trim())) {
            found = true;
        }
    });
    return found;
  }
  const globalReducer = (state={},action)=>{
    return{
      user:user(state.user,action),
    };
  };
  const globalStore = Redux.createStore(globalReducer,Redux.applyMiddleware(ReduxThunk.default));
  const GlobalStoreMixin = PolymerRedux(globalStore);
</script>
